# ==============================================
# ğŸ§  training.yaml
# ==============================================

meta:
  project_name: yolo-autolabel-trainer
  version_tag: v1.0.0
  description: YOLOv12 automated training workflow
  author: user
  date: 2025-10-20

# ----------------------------------------------
# âš™ï¸ 1ï¸âƒ£ ê¸°ë³¸ í•™ìŠµ ì„¤ì •
# ----------------------------------------------
train:
  model_name: yolo12n.pt              # base model (fresh í•™ìŠµ ì‹œ)
  epochs: 100
  batch: 16
  imgsz: 640
  workers: 8
  optimizer: SGD                      # ë˜ëŠ” AdamW
  lr0: 0.001
  lrf: 0.01                           # final learning rate fraction
  weight_decay: 0.0005
  momentum: 0.937
  warmup_epochs: 3
  warmup_bias_lr: 0.1
  augment: true
  mosaic: true
  mixup: false
  amp: true                           # ìë™ í˜¼í•©ì •ë°€ë„ (AMP)
  patience: 20                        # ì¡°ê¸° ì¢…ë£Œ (early stop)

# ----------------------------------------------
# ğŸ§© 2ï¸âƒ£ í•˜ì´í¼íŒŒë¼ë¯¸í„° íƒìƒ‰(HPO) ì„¤ì •
# ----------------------------------------------
hpo:
  enabled: true
  max_trials: 20
  search_space:
    lr0: [0.0005, 0.005]
    batch: [8, 16, 32]
    momentum: [0.85, 0.95]
    weight_decay: [0.0001, 0.001]
    epochs: [50, 100, 150]
  metric: "mAP50-95"
  direction: "maximize"
  sampler: "TPESampler"
  pruner: "MedianPruner"

# ----------------------------------------------
# ğŸ§® 3ï¸âƒ£ ê²Œì´íŠ¸(íšŒê·€ ë°©ì§€) ê¸°ì¤€
# ----------------------------------------------
gate:
  enabled: true
  min_mAP: 0.6                # ì ˆëŒ€ í•˜í•œì„ 
  delta_mAP: -0.02            # ì´ì „ ë²„ì „ ëŒ€ë¹„ í—ˆìš© ê°ì†Œ í­
  min_class_ap: 0.4           # íŠ¹ì • í´ë˜ìŠ¤ í•˜í•œ
  check_latency: true
  max_latency_ms: 50          # Jetson ëª©í‘œ fps ê³ ë ¤

# ----------------------------------------------
# ğŸ§° 4ï¸âƒ£ í•˜ë“œì›¨ì–´ / ë°°í¬ íƒ€ê¹ƒ ì„¤ì •
# ----------------------------------------------
hardware:
  device: "cuda:0"
  mixed_precision: true
  cudnn_benchmark: true
  max_vram_gb: 8
  # target_profile: null   # configs/targets/ ë‚´ì— ë³„ë„ íŒŒì¼ ì—°ê²°

# ----------------------------------------------
# ğŸ§© 5ï¸âƒ£ ë°ì´í„° ê²½ë¡œ / ë²„ì „ ê´€ë¦¬
# ----------------------------------------------
data:
  dataset_version: dataset@1.0.0
  yaml_path: data/datasets/dataset@1.0.0/data.yaml
  cache_images: true
  augmentations_dir: configs/augs/        # (ì„ íƒ)
  split_ratio: [0.8, 0.2]                 # train:valid

# ----------------------------------------------
# ğŸ” 6ï¸âƒ£ ì¦ë¶„ í•™ìŠµ / ì¬í•™ìŠµ ì˜µì…˜
# ----------------------------------------------
resume:
  enable: false
  last_ckpt: null
  finetune_base: null
  freeze_backbone: false
  lr_factor: 0.5

# ----------------------------------------------
# ğŸš€ 7ï¸âƒ£ ë‚´ë³´ë‚´ê¸° / TensorRT ë³€í™˜ ì„¤ì •
# ----------------------------------------------
export:
  enabled: true
  formats:
    - onnx
    - engine
  engine:
    half: true
    int8: true
    calibration_data: data/datasets/dataset@1.0.0/images/train/
    max_workspace_size: 2048
    dynamic_shapes: true

# ----------------------------------------------
# ğŸ§ª 8ï¸âƒ£ ê²€ì¦ ë° ë²¤ì¹˜ë§ˆí¬ ì˜µì…˜
# ----------------------------------------------
eval:
  conf_thres: 0.25
  iou_thres: 0.6
  save_json: true
  save_confusion_matrix: true
  benchmark:
    fps: true
    vram: true
    latency: true

# ----------------------------------------------
# ğŸª£ 9ï¸âƒ£ ê²°ê³¼ ì €ì¥ / ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™
# ----------------------------------------------
registry:
  enabled: true
  save_to: registry/models.json
  save_metrics: true
  auto_versioning: true
  notes: "YOLOv12 training with automatic HPO and TRT export"
